🎬 INSTAGRAM CONTENT GENERATION FLOW
=====================================

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           USER INTERACTION                                      │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Frontend: "Generate Content" Button Clicked                                    │
│  POST /ai/generate-content                                                      │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    CONTENT PLANNING PHASE                                      │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Load Schedule   │───▶│ Load Account     │───▶│ Generate Ideas  │           │
│  │ & Time Slots    │    │ Settings        │    │ (LLM Service)   │           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    CONTENT IDEAS GENERATED                                      │
│  • Posts with images                                                           │
│  • Reels (30s videos)                                                          │
│  • Stories (30s videos)                                                        │
│  • Captions, hashtags, visual ideas                                            │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    CONTENT PROCESSING                                           │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Create Content  │───▶│ Set Duration    │───▶│ Route to Agent  │           │
│  │ Records         │    │ (30s for videos)│    │ (Image/Reel)    │           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    REEL/STORY GENERATION                                        │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Enhance Content │───▶│ Add Character   │───▶│ Add Setting     │           │
│  │ Idea            │    │ Details         │    │ Details         │           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    EXTENDED VIDEO GENERATION                                    │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Generate Script │───▶│ Create Segments │───▶│ Generate Videos  │           │
│  │ (4 segments)    │    │ (8s each)       │    │ (Sequentially)   │           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    SEGMENT GENERATION PROCESS                                   │
│                                                                                 │
│  SEGMENT 1 (First Segment):                                                     │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Generate Video  │───▶│ Store in GCS    │───▶│ Extract Frame   │           │
│  │ (Veo 3 API)     │    │ (segment_1.mp4) │    │ (last_frame.jpg)│           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
│                                                                                 │
│  SEGMENT 2 (Continuation):                                                      │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Use Reference   │───▶│ Generate Video  │───▶│ Extract Frame   │           │
│  │ Image (Frame)   │    │ (Veo 3 API)     │    │ (last_frame.jpg)│           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
│                                                                                 │
│  SEGMENT 3 (Continuation):                                                      │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Use Reference   │───▶│ Generate Video  │───▶│ Extract Frame   │           │
│  │ Image (Frame)   │    │ (Veo 3 API)     │    │ (last_frame.jpg)│           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
│                                                                                 │
│  SEGMENT 4 (Final):                                                             │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Use Reference   │───▶│ Generate Video  │───▶│ No Frame Extract│           │
│  │ Image (Frame)   │    │ (Veo 3 API)     │    │ (Final Segment)  │           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    VIDEO CONCATENATION                                           │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Download Segments│───▶│ Concatenate     │───▶│ Save Final Video│           │
│  │ from GCS         │    │ (FFmpeg)        │    │ (Local Storage)  │           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    CLEANUP & STORAGE                                            │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │ Delete Segments │───▶│ Update Database│───▶│ Return Media    │           │
│  │ from GCS        │    │ (Media Record)  │    │ Result           │           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           FINAL OUTPUT                                         │
│  • 30-second cohesive video                                                    │
│  • Consistent character and setting                                            │
│  • Professional quality                                                       │
│  • Instagram-ready format                                                      │
│  • Stored locally with database metadata                                       │
└─────────────────────────────────────────────────────────────────────────────────┘

🔧 TECHNICAL COMPONENTS
=======================

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   AI Services   │    │ Video Processing│    │   Storage       │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • Vertex AI     │    │ • FFmpeg        │    │ • Google Cloud  │
│ • Veo 3         │    │ • Frame Extract │    │ • Local Files   │
│ • Gemini        │    │ • Concatenation │    │ • PostgreSQL    │
│ • LangChain     │    │ • fluent-ffmpeg │    │ • TypeORM       │
└─────────────────┘    └─────────────────┘    └─────────────────┘

📊 PERFORMANCE METRICS
======================

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ Processing Time │    │ Storage Usage   │    │ Quality Output  │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • Content Plan: │    │ • Segments:     │    │ • 30s Video     │
│   30-60 seconds │    │   5-10MB each   │    │ • 9:16 Aspect   │
│ • Script Gen:   │    │ • Frames:       │    │ • HD Quality    │
│   10-15 seconds │    │   200-500KB     │    │ • Smooth Trans  │
│ • Segment Gen:  │    │ • Final Video:  │    │ • Consistent    │
│   2-3 min each  │    │   15-25MB       │    │ • Professional  │
│ • Total Time:   │    │ • Total:        │    │ • Instagram     │
│   12-15 minutes │    │   25-45MB       │    │   Ready         │
└─────────────────┘    └─────────────────┘    └─────────────────┘

🎯 SUCCESS CRITERIA
===================

✅ Visual Consistency
  • Same character across segments
  • Consistent lighting and colors
  • Smooth transitions
  • Professional quality

✅ Technical Performance
  • Reliable frame extraction
  • Successful concatenation
  • Proper cleanup
  • Database integrity

✅ User Experience
  • 30-second cohesive videos
  • Instagram-ready format
  • High-quality output
  • Consistent results

🚀 DEPLOYMENT
=============

Development:  npm run start:dev
Production:   npm run build && npm run start:prod
Environment:  Set GCS bucket, Vertex AI project, location

This comprehensive flow ensures professional-quality, consistent 30-second videos! 🎥✨
